google.maps.Polygon.prototype.my_getBounds=function(){var a=new google.maps.LatLngBounds();this.getPath().forEach(function(c,b){a.extend(c);});return a;
};(function(d,p){var s,l;l=new google.maps.LatLng(37.544577320855815,127.02392578125);s=new google.maps.Map(document.getElementById("map"),{zoom:13,center:l,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDoubleClickZoom:true});
var f=[];var b=[];var n=null;google.maps.event.addListener(s,"dblclick",function(g){if(n!==null){n.setMap(null);}f.push([g.latLng.lat(),g.latLng.lng()]);
b.push(g.latLng);if(f.length>2){n=new google.maps.Polygon({paths:b,map:s});google.maps.event.addListener(n,"click",function(v){var t=[];for(var u=0;u<f.length;
u++){t.push(f[u][0]+" "+f[u][1]);}t.push(f[0][0]+" "+f[0][1]);alert("POLYGON(("+t.join(",")+"))");f=[];b=[];n.setMap(null);});}});var m=d("#SearchFormSpatial");
var i=d("#SearchFormFormula");var c=d("#SearchFormAutocomplete");var h=null;var q=false;var r=null;var k=function(g){if(q){return;}q=true;d.ajax({type:"GET",url:"http://localhost:5000/ajax/getPolygon",data:{formula:g},success:function(x){if(r!==null){if(r.length){for(var w=0,t=r.length;
w<t;w++){if(r[w].length){for(var v=0,u=r[w].length;v<u;v++){r[w][v].setMap(null);}}else{r[w].setMap(null);}}}else{r.setMap(null);}}r=new GeoJSON(p.Geometry.text2geo(x.result));
if(r.type&&r.type=="Error"){return;}if(r.length){for(var w=0;w<r.length;w++){if(r[w].length){for(var v=0;v<r[w].length;v++){r[w][v].setMap(s);}}else{r[w].setMap(s);
}}}else{r.setMap(s);}q=false;}});};var o=function(){var w=m.find("div.group");var y="";for(var v=0,g=w.length;v<g;v++){var u=w.eq(v);var t=u.find("input.spatial-name").data("idx");
var x=u.find("select.spatial-operator").find("option:selected").val();y+=t;y+=x;if(x==="="){break;}}return y;};var j=function(){k(o());};c.find("ul").on("click","li",function(){var g=d(this).data("idx");
h.data("idx",g);h.val(d(this).data("name"));c.find("ul").empty();j();});var a=[];d("#SearchForm").bind("submit",function(g){g.preventDefault();d.ajax({type:"GET",url:"http://localhost:5000/ajax/searchResult",data:{operator:d("#SearchFormOperate").find("option:selected").val(),formula:o(),keyword:d("#SearchFormKeyword").val()},success:function(w){if(w.result===false){return;
}if(w.result.length){if(a.length){for(var x=0,y=a.length;x<y;x++){a[x].setMap(null);}}for(var x=0,y=w.result.length;x<y;x++){var u=p.Geometry.text2geo(w.result[x][0]);
if(u.type==="Point"){var t=u.coordinates;a[x]=new google.maps.Marker({position:new google.maps.LatLng(t[1],t[0]),animation:google.maps.Animation.DROP,map:s});
(function(C,F,D){var E=new google.maps.InfoWindow({content:'<div class="title">'+F+"</div>"});google.maps.event.addListener(a[x],"mouseover",function(){E.open(s,C);
});google.maps.event.addListener(a[x],"mouseout",function(){E.close();});google.maps.event.addListener(a[x],"click",function(){window.open(D);});})(a[x],w.result[x][1],w.result[x][2]);
}else{if(u.type==="Polygon"){var A=u.coordinates[0];var z=[];for(var v=0,B=A.length;v<B;v++){z.push(new google.maps.LatLng(A[v][1],A[v][0]));}a[x]=new google.maps.Polygon({paths:z,strokeColor:"#57a1f3",strokeOpacity:0.8,strokeWeight:3,fillColor:"#90bef3",fillOpacity:0.35,map:s});
(function(D,G,E){var F=new google.maps.InfoWindow({content:'<div class="title">'+G+"</div>"});var C=false;google.maps.event.addListener(a[x],"mouseover",function(H){if(C){return;
}C=true;F.open(s);F.setPosition(H.latLng);});google.maps.event.addListener(a[x],"mouseout",function(){F.close();C=false;});google.maps.event.addListener(a[x],"click",function(){window.open(E);
});})(a[x],w.result[x][1],w.result[x][2]);}}}}},error:function(t){console.log("error");}});});m.on("keyup","input",function(){h=d(this);var g=d(this).val();
c.css("left",d(this).offset().left);p.autocompleteSpatial(g);});var e=m.html();m.on("change","select",function(){var t=d(this).parent();j();if(d(this).find("option:selected").val()==="="){t.nextAll().addClass("hidden");
return;}if(t.next().length!==0){var g=t.next();while(true){g.removeClass("hidden");if(g.find("select.spatial-operator").find("option:selected").val()==="="){break;
}g=g.next();}return;}m.append(e);});})(jQuery,window);