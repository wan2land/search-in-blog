google.maps.Polygon.prototype.my_getBounds=function(){var a=new google.maps.LatLngBounds();this.getPath().forEach(function(c,b){a.extend(c);});return a;
};(function(d,p){var s,l;l=new google.maps.LatLng(37.544577320855815,127.02392578125);s=new google.maps.Map(document.getElementById("map"),{zoom:13,center:l,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDoubleClickZoom:true});
var f=[];var b=[];var n=null;google.maps.event.addListener(s,"dblclick",function(g){if(n!==null){n.setMap(null);}f.push([g.latLng.lat(),g.latLng.lng()]);
b.push(g.latLng);if(f.length>2){n=new google.maps.Polygon({paths:b,map:s});google.maps.event.addListener(n,"click",function(v){var t=[];for(var u=0;u<f.length;
u++){t.push(f[u][0]+" "+f[u][1]);}t.push(f[0][0]+" "+f[0][1]);alert("POLYGON(("+t.join(",")+"))");f=[];b=[];n.setMap(null);});}});var m=d("#SearchFormSpatial");
var i=d("#SearchFormFormula");var c=d("#SearchFormAutocomplete");var h=null;var q=false;var r=null;var k=function(g){if(q){return;}q=true;d.ajax({type:"GET",url:"http://localhost:5000/ajax/getPolygon",data:{formula:g},success:function(x){if(r!==null){if(r.length){for(var w=0,t=r.length;
w<t;w++){if(r[w].length){for(var v=0,u=r[w].length;v<u;v++){r[w][v].setMap(null);}}else{r[w].setMap(null);}}}else{r.setMap(null);}}r=new GeoJSON(p.Geometry.text2geo(x.result));
if(r.type&&r.type=="Error"){return;}if(r.length){for(var w=0;w<r.length;w++){if(r[w].length){for(var v=0;v<r[w].length;v++){r[w][v].setMap(s);}}else{r[w].setMap(s);
r[w].setOptions({strokeColor:"#165724",strokeOpacity:0.8,strokeWeight:3,fillColor:"#54f380",fillOpacity:0.35,map:s});}}}else{r.setMap(s);r.setOptions({strokeColor:"#165724",strokeOpacity:0.8,strokeWeight:3,fillColor:"#54f380",fillOpacity:0.35,map:s});
}console.log(r);q=false;}});};var o=function(){var w=m.find("div.group");var y="";for(var v=0,g=w.length;v<g;v++){var u=w.eq(v);var t=u.find("input.spatial-name").data("idx");
var x=u.find("select.spatial-operator").find("option:selected").val();if(typeof t==="undefined"){continue;}y+=t;y+=x;if(x==="="){break;}}return y;};var j=function(){k(o());
};c.find("ul").on("click","li",function(){var g=d(this).data("idx");h.data("idx",g);h.val(d(this).data("name"));c.find("ul").empty();j();});var a=[];d("#SearchForm").bind("submit",function(g){g.preventDefault();
var t=o();if(t===""){alert("장소를 지정하셔야 합니다.");d("input.spatial-name").eq(0).focus();return;}d.ajax({type:"GET",url:"http://localhost:5000/ajax/searchResult",data:{operator:d("#SearchFormOperate").find("option:selected").val(),formula:t,keyword:d("#SearchFormKeyword").val()},success:function(x){if(x.result===false){return;
}if(x.result.length){if(a.length){for(var y=0,z=a.length;y<z;y++){a[y].setMap(null);}}for(var y=0,z=x.result.length;y<z;y++){var v=p.Geometry.text2geo(x.result[y][0]);
if(v.type==="Point"){var u=v.coordinates;a[y]=new google.maps.Marker({position:new google.maps.LatLng(u[1],u[0]),animation:google.maps.Animation.DROP,map:s});
(function(D,G,E){var F=new google.maps.InfoWindow({content:'<div class="title">'+G+"</div>"});google.maps.event.addListener(a[y],"mouseover",function(){F.open(s,D);
});google.maps.event.addListener(a[y],"mouseout",function(){F.close();});google.maps.event.addListener(a[y],"click",function(){window.open(E);});})(a[y],x.result[y][1],x.result[y][2]);
}else{if(v.type==="Polygon"){var B=v.coordinates[0];var A=[];for(var w=0,C=B.length;w<C;w++){A.push(new google.maps.LatLng(B[w][1],B[w][0]));}a[y]=new google.maps.Polygon({paths:A,strokeColor:"#57a1f3",strokeOpacity:0.8,strokeWeight:3,fillColor:"#90bef3",fillOpacity:0.35,map:s});
(function(E,H,F){var G=new google.maps.InfoWindow({content:'<div class="title">'+H+"</div>"});var D=false;google.maps.event.addListener(a[y],"mouseover",function(I){if(D){return;
}D=true;G.open(s);G.setPosition(I.latLng);});google.maps.event.addListener(a[y],"mouseout",function(){G.close();D=false;});google.maps.event.addListener(a[y],"click",function(){window.open(F);
});})(a[y],x.result[y][1],x.result[y][2]);}}}}},error:function(u){console.log("error");}});});m.on("keyup","input",function(){h=d(this);var g=d(this).val();
c.css("left",d(this).offset().left);p.autocompleteSpatial(g);});var e=m.html();m.on("change","select",function(){var t=d(this).parent();j();if(d(this).find("option:selected").val()==="="){t.nextAll().addClass("hidden");
return;}if(t.next().length!==0){var g=t.next();while(true){g.removeClass("hidden");if(g.find("select.spatial-operator").find("option:selected").val()==="="){break;
}g=g.next();}return;}m.append(e);});})(jQuery,window);